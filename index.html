<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">   
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Repert√≥rio - Minist√©rio de Louvor</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#f59e0b">
</head>
<body>
  <header>
    <h1>Repert√≥rio - Minist√©rio Tabern√°culo de Davi</h1>
    <p class="subtitle">Filtre por categoria, busque por t√≠tulo ou clique para ver letra e ouvir.</p>
  </header>

  <nav class="controls">
    <div class="categories" id="categories"></div>
    <input id="search" placeholder="Pesquisar m√∫sica ou autor..." />
    <button id="clear">Limpar filtro</button>

    <button id="add-song-btn">Adicionar m√∫sica</button>
    <button id="select-mode-btn">üéµ Selecionar m√∫sicas</button>
    <button id="send-whatsapp-btn" style="display:none;">üì± Enviar pelo WhatsApp</button>
  </nav>

  <main id="song-list" class="grid"></main>

  <footer><small></small></footer>

  <!-- Modal m√∫sica -->
  <div id="modal" class="modal hidden" role="dialog" aria-modal="true">
    <div class="modal-content">
      <button id="close-modal" class="close">‚úï</button>
      <h2 id="modal-title"></h2>
      <p id="modal-meta"></p>
      <div id="player-area"></div>
      <pre id="lyrics" class="lyrics"></pre>
      <button id="expand-lyrics-btn">Expandir letra</button>
      <p class="note">Se o player n√£o tocar, abra o link diretamente no YouTube/Spotify.</p>
    </div>
  </div>

  <!-- Modal adicionar m√∫sica -->
  <div id="add-modal" class="modal hidden">
    <div class="modal-content">
      <button id="close-add-modal" class="close">‚úï</button>
      <h2>Adicionar Nova M√∫sica</h2>
      <form id="add-song-form">
        <label>T√≠tulo:<br><input id="new-title" required /></label><br>
        <label>Autor:<br><input id="new-author" /></label><br>
        <label>Categorias (separadas por v√≠rgula):<br><input id="new-categories" /></label><br>
        <label>Link (YouTube/Spotify):<br><input id="new-link" /></label><br>
        <label>Letra:<br><textarea id="new-lyrics" rows="6"></textarea></label><br>
        <button type="submit">Adicionar</button>
      </form>
    </div>
  </div>

  <!-- Modal sele√ß√£o de culto -->
  <div id="service-modal" class="modal hidden">
    <div class="modal-content">
      <button id="close-service-modal" class="close">‚úï</button>
      <h2>Selecionar culto</h2>
      <p>Para qual culto e data voc√™ est√° montando o repert√≥rio?</p>
      <form id="service-form">
        <label><input type="radio" name="service" value="EBD" required> EBD</label><br>
        <label><input type="radio" name="service" value="Quarta-feira"> Quarta-feira</label><br>
        <label><input type="radio" name="service" value="Domingo √† noite"> Domingo √† noite</label><br>
        <label>
          <input type="radio" name="service" value="Outro"> Outro: 
          <input id="custom-service" placeholder="Especifique" disabled />
        </label><br>
        <label>Data: <input type="date" id="service-date" required></label><br>
        <button type="submit">Confirmar</button>
      </form>
    </div>
  </div>

  <script type="module" src="script.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('./sw.js').then(reg => {
      console.log('‚úÖ Service Worker registrado:', reg.scope);

      // Detecta nova vers√£o e atualiza automaticamente
      reg.addEventListener('updatefound', () => {
        const newWorker = reg.installing;
        newWorker.addEventListener('statechange', () => {
          if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
            console.log('üÜï Nova vers√£o dispon√≠vel! Atualizando...');
            newWorker.postMessage({ type: 'SKIP_WAITING' });
          }
        });
      });
    }).catch(err => console.error('‚ùå Falha ao registrar SW:', err));
  });
}

  </script>
</body>
</html>
